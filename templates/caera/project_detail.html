{% extends "base.html" %}

{% block content %}
  <div class="partition">
    {% if project.image %}
      <div class="image_detail">
        <img class="image" src="{{ project.image.url }}" alt="Project image">
      </div>
    {% else %}
    {% endif %}
    <div class="info">
      <h1>
        {{ project.title }}
        <a href="{% url 'caera:project-delete' pk=proposal.id project_pk=project.id %}"
           class="btn btn-danger link-to-page">
          –í–∏–¥–∞–ª–∏—Ç–∏
        </a>

        <a href="{% url 'caera:project-update' pk=proposal.id project_pk=project.id %}"
           class="btn btn-secondary link-to-page">
          –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
        </a>
      </h1>

      <form method="post" action="{% url 'caera:project-like-toggle' pk=proposal.pk project_pk=project.pk %}">
        {% csrf_token %}
        <button type="submit" name="value" value="like"
                class="btn {% if user_like and user_like.value == 'like' %}btn-success{% else %}btn-outline-success{% endif %}">
          üëç ({{ project.like_count }})
        </button>

        <button type="submit" name="value" value="dislike"
                class="btn {% if user_like and user_like.value == 'dislike' %}btn-danger{% else %}btn-outline-danger{% endif %}">
          üëé ({{ project.dislike_count }})
        </button>
      </form>

      <form method="post" action="{% url 'caera:project-paid-reaction-toggle' pk=proposal.pk project_pk=project.pk %}">
        {% csrf_token %}
        <button type="submit"
                class="btn {% if user_paid_reaction %}btn-warning{% else %}btn-outline-warning{% endif %}">
          ‚≠ê ({{ project.paid_reactions.count }})
        </button>
      </form>

    </div>
  </div>

  <div class="proposal-description">
    {{ project.description }}
  </div>

  <div class="card my-4">
    <div class="card-body">
      <h5 class="card-title">–ó–±—ñ—Ä –∫–æ—à—Ç—ñ–≤</h5>

      <p class="card-text mb-2">
        –ú–µ—Ç–∞: <strong>{{ project.fundraising_goal }} –≥—Ä–Ω.</strong><br>
        –ó—ñ–±—Ä–∞–Ω–æ: <strong>{{ project.total_donated }} –≥—Ä–Ω.</strong>
      </p>

      <div class="progress" style="height: 25px;">
        <div class="progress-bar
                  {% if project.fundraising_progress_percent < 50 %}
                    bg-warning
                  {% elif project.fundraising_progress_percent < 100 %}
                    bg-info
                  {% else %}
                    bg-success
                  {% endif %}"
             role="progressbar"
             style="width: {{ project.fundraising_progress_percent }}%;"
             aria-valuenow="{{ project.fundraising_progress_percent }}"
             aria-valuemin="0"
             aria-valuemax="100">
          {{ project.fundraising_progress_percent|floatformat:0 }}%
        </div>
      </div>

      <form method="post" action="{% url 'caera:project-donate' pk=proposal.pk project_pk=project.pk %}" class="mt-3">
        {% csrf_token %}
        <div class="input-group">
          <input type="number" name="amount" min="1" step="0.01" class="form-control" placeholder="–°—É–º–∞ –¥–æ–Ω–∞—Ç—É">
          <button type="submit" class="btn btn-outline-primary">–ó–∞–¥–æ–Ω–∞—Ç–∏—Ç–∏</button>
        </div>
      </form>
    </div>
  </div>

  <div class="reviews">
    <h2 class="review_h2">
      –ö–æ–º–º–µ–Ω—Ç–∞—Ä—ñ

      <a href="{% url 'caera:project-comment-create' pk=proposal.id project_pk=project.id %}" class="btn link-to-page"
         style="color: forestgreen">
        –ö–æ–º–º–µ–Ω—Ç—É–≤–∞—Ç–∏
      </a>
    </h2>

    <hr>
    {% for comment in project.comments.all %}
      <div class="question">
        {{ comment.user.username }}

        <p>
          {{ comment.created_at }}
        </p>

        <p>
          {{ comment.text }}
        </p>

        {% if comment.user == request.user %}
          <div class="d-flex gap-2">
            <a href="{% url 'caera:project-comment-update' pk=proposal.id project_pk=project.id comment_pk=comment.id %}"
               class="btn btn-sm btn-outline-primary">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            <a href="{% url 'caera:project-comment-delete' pk=proposal.id project_pk=project.id comment_pk=comment.id %}"
               class="btn btn-sm btn-outline-danger">–í–∏–¥–∞–ª–∏—Ç–∏</a>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% endblock %}
